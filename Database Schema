-- Database Setup Script for BudgetPilot

-- 1. Persons Table (Users)
CREATE TABLE Persons (
    person_id VARCHAR(255) PRIMARY KEY,
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 2. Funds Table (Wallets/Accounts)
CREATE TABLE Funds (
    fund_id INT AUTO_INCREMENT PRIMARY KEY,
    person_id VARCHAR(255) NOT NULL,
    fund_name VARCHAR(100) NOT NULL,
    fund_type VARCHAR(50) NOT NULL, -- e.g., 'Cash', 'Bank', 'Crypto'
    current_balance DECIMAL(15, 2) DEFAULT 0.00,
    FOREIGN KEY (person_id) REFERENCES Persons(person_id)
);

-- 3. Transactions Table (Income/Expenses)
CREATE TABLE Transactions (
    transaction_id INT AUTO_INCREMENT PRIMARY KEY,
    fund_id INT NOT NULL,
    type ENUM('INCOME', 'EXPENSE') NOT NULL,
    amount DECIMAL(15, 2) NOT NULL,
    category VARCHAR(100) NOT NULL, -- e.g., 'Groceries', 'Salary', 'Rent', 'Investment'
    date DATE NOT NULL,
    description VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (fund_id) REFERENCES Funds(fund_id)
);

-- 4. Budgets Table (Monthly Budget Targets)
CREATE TABLE Budgets (
    budget_id INT AUTO_INCREMENT PRIMARY KEY,
    person_id VARCHAR(255) NOT NULL,
    category VARCHAR(100) NOT NULL,
    allocated_amount DECIMAL(15, 2) NOT NULL,
    budget_month DATE NOT NULL, -- Stored as the 1st of the month (YYYY-MM-01)
    UNIQUE KEY unique_budget (person_id, category, budget_month),
    FOREIGN KEY (person_id) REFERENCES Persons(person_id)
);

-- 5. InvestmentTypes Table (Master list of products)
CREATE TABLE InvestmentTypes (
    type_id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) UNIQUE NOT NULL,
    risk_level VARCHAR(50) NOT NULL, -- e.g., 'Low', 'Moderate', 'High'
    description TEXT
);

-- Insert initial investment types
INSERT INTO InvestmentTypes (name, risk_level, description) VALUES
('Money Market Funds (MMF)', 'Low', 'Highly liquid, low-risk investments.'),
('S&P 500 Index ETF', 'Moderate', 'Tracks the performance of the S&P 500 index.'),
('High-Growth Tech Stocks', 'High', 'Individual stocks in the technology sector, high risk/reward.');

-- 6. Investments Table (User's chosen allocations)
CREATE TABLE Investments (
    investment_id INT AUTO_INCREMENT PRIMARY KEY,
    person_id VARCHAR(255) NOT NULL,
    type_id INT NOT NULL,
    allocated_fund DECIMAL(15, 2) NOT NULL,
    date_chosen DATE NOT NULL,
    FOREIGN KEY (person_id) REFERENCES Persons(person_id),
    FOREIGN KEY (type_id) REFERENCES InvestmentTypes(type_id)
);
